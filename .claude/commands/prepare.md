---
description: Prepare project (hearing → spec → critique → breakdown)
---

**プロジェクト計画の一気通貫実行**

ヒアリング → 仕様書作成 → レビュー → Issue分解 を一連の流れで実行します。

---

## 全体フロー

```
/prepare
│
├─── ヒアリングフェーズ（対話あり）─────────────┐
│    ユーザーと対話して要件を明確化              │
│    要件サマリーの承認を得る                   │
└───────────────────────────────────────────────┘
         ↓ 承認後
┌─── 自動実行フェーズ（確認なし）───────────────┐
│    @Product_Manager → @Critic → @Issue_Planner │
│    途中で停止・確認しない                     │
└───────────────────────────────────────────────┘
         ↓
     最終報告
```

---

# ヒアリングフェーズ（対話あり）

## 目的

実装に必要な情報を全て明確にする。
**形式的な質問回数ではなく、情報の完全性で判断する。**

## 初回質問

「何を作りたいですか？」

## 必須確認項目

以下の項目が **全て明確になるまで** ヒアリングを続行する：

| # | 項目 | 確認すべきこと |
|---|------|---------------|
| 1 | **入力仕様** | 何を受け取るか？データ形式は？ソースは？ |
| 2 | **出力仕様** | 何を生成するか？データ形式は？保存先は？ |
| 3 | **処理ロジック** | 入力→出力の変換ルールは？ |
| 4 | **エラー処理** | 異常時の動作は？（ファイルがない、形式が違う等） |
| 5 | **スコープ外** | やらないことは何か？ |
| 6 | **成功基準** | 何をもって完了とするか？ |

## 質問のルール

- **曖昧な回答には具体例を求める**
- **選択肢を提示して絞り込む**
- **自分の理解を述べて確認を取る**
- **開放型質問は避ける**（「他にありますか？」は使わない）

## 要件サマリーと承認

全項目が明確になったら：

1. **要件サマリーを提示**

```markdown
## 要件サマリー

### 概要
[1-2文で何を作るか]

### 入力
- [入力データの形式・ソース]

### 出力
- [出力データの形式・保存先]

### 主要機能
1. [機能1]
2. [機能2]

### エラー処理
- [異常系の扱い]

### スコープ外（やらないこと）
- [除外する機能]

### 成功基準
- [完了条件]
```

2. **承認を求める**

「この内容で仕様書を作成し、レビュー、Issue分解まで自動実行します。よろしいですか？」

3. **承認を得てから自動実行フェーズへ進む**

---

# 自動実行フェーズ（確認なし）

**重要: このフェーズではユーザーに確認を求めない。途中で停止しない。**

## フェーズ1: 仕様書作成

**@Product_Manager** に仕様書作成を依頼する（Task tool経由でサブエージェントとして呼び出し）。

**依頼内容**:
- ヒアリングで得た要件サマリーを渡す
- `docs/specs/spec-{YYYYMMDD-HHMMSS}.md` に仕様書を作成

**完了したら、停止せずにフェーズ2へ進む。**

---

## フェーズ2: レビュー

**@Critic** に仕様書のレビューを依頼する（Task tool経由でサブエージェントとして呼び出し）。

**依頼内容**:
- 作成した仕様書のパスを渡す
- レビュー結果を受け取る

**判定と対応**:
- `APPROVED`: フェーズ3へ進む
- `REQUEST_CHANGES`: @Product_Manager に修正を依頼し、再度 @Critic にレビュー依頼（最大3ラウンド）

**レビュー通過したら、停止せずにフェーズ3へ進む。**

---

## フェーズ3: Issue分解

**@Issue_Planner** に仕様書のIssue分解を依頼する（Task tool経由でサブエージェントとして呼び出し）。

**依頼内容**:
- レビュー通過した仕様書のパスを渡す
- GitHub Issueを `label:todo` で作成

**出力**: GitHub Issues（`label:todo`）

---

## 最終報告（全フェーズ完了後）

全フェーズ完了後、ユーザーに以下を報告:

1. **作成した仕様書**: ファイルパス
2. **レビュー結果**: APPROVEDまでのラウンド数
3. **作成したIssue一覧**: Issue番号とタイトルの一覧
4. **次のステップ**: `/auto` で全Issue自動実装、または `/run {issue番号}` で個別実装

---

## 完了条件

- ヒアリングで要件サマリーの承認を得ている
- 仕様書が `docs/specs/` に保存されている
- @Critic からAPPROVED判定を受けている
- GitHub Issueが `todo` ラベル付きで作成されている
- ユーザーに最終報告済み
